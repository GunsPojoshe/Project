<!-- sales.html -->

{% extends 'base.html' %}

{% block title %}Продажи{% endblock %}

{% block content %}
    {% if session.get('user_id') %}
    <nav class="top-nav-bar">
        <a href="{{ url_for('home') }}" class="{{ 'active' if request.endpoint == 'home' else '' }}">Главная</a>
        <a href="{{ url_for('sales') }}" class="{{ 'active' if request.endpoint == 'sales' else '' }}">Продажи</a>
        <a href="{{ url_for('stock') }}" class="{{ 'active' if request.endpoint == 'stock' else '' }}">Остатки</a>
        
        <div class="profile-menu">
            <div class="profile-button" id="menuButton">
                <span class="profile-label">Учетная запись</span>
            </div>
            <div class="dropdown-menu" id="dropdownMenu">
                <a href="{{ url_for('profile') }}" class="{{ 'active' if request.endpoint == 'profile' else '' }}">Профиль</a>
                <a href="{{ url_for('profilesettings') }}" class="{{ 'active' if request.endpoint == 'profilesettings' else '' }}">Настройки профиля</a>
                <a href="{{ url_for('logout') }}">Выйти</a>
            </div>
        </div>
    </nav>

    <!-- Выпадающее меню для переключения видимости колонок -->
    <div class="column-toggle-menu">
        <button class="toggle-menu-button">Управление колонками</button>
        <div class="dropdown-column-menu">
            {% for col in columns %}
            <label>
                <input type="checkbox" class="column-toggle" data-column="{{ loop.index0 }}" checked>
                {{ col }}
            </label>
            {% endfor %}
        </div>
    </div>

    <!-- Обёртка для таблицы -->
    <div class="table-wrapper" id="tableWrapper">
        <table class="sales-table">
            <thead>
                <tr>
                    {% for col in columns %}
                    <th>
                        <span class="column-title" data-column="{{ loop.index0 }}">{{ col }}</span>
                        <button class="edit-column-btn" data-column="{{ loop.index0 }}">✏️</button>
                    </th>
                    {% endfor %}
                </tr>
            </thead>
            <tbody>
                {% for item in sales_data %}
                <tr>
                    {% for col in columns %}
                    <td>{{ item[col] }}</td>
                    {% endfor %}
                </tr>
                {% else %}
                <tr>
                    <td colspan="{{ columns|length }}">Данные отсутствуют</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% endif %}
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/sales.js') }}" defer></script>
{% endblock %}
